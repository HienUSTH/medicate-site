<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mini dashboard — Medicate</title>
  <meta name="description" content="Mini dashboard Medicate: xem nhanh chỉ số và báo cáo." />

  <!-- Favicon: GIỮ NGUYÊN theo file của bạn -->
  <link rel="icon" href="assets/img/favicon.png">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Nunito Sans (Semibold 600) -->
  <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@600;700;800&display=swap" rel="stylesheet">
  <style>.font-nunito{font-family:"Nunito Sans",ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial}</style>
</head>
<body class="bg-slate-50 text-slate-800">
  <!-- NAVBAR (giữ nguyên logo = assets/img/favicon.png như bạn đang dùng) -->
  <header class="sticky top-0 z-50 bg-white/90 backdrop-blur border-b border-slate-200">
    <div class="max-w-screen-xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <a href="index.html" class="flex items-center gap-2 font-semibold">
          <img src="assets/img/favicon.png" alt="Medicate" class="h-10 w-10" />
          <span class="text-lg">Medicate</span>
        </a>

        <nav class="hidden md:flex items-center gap-6">
          <a href="index.html" class="py-2 hover:text-sky-700">Trang chủ</a>

          <div class="relative" data-dd="devices">
            <button class="py-2 hover:text-sky-700 flex items-center gap-1 dd-toggle">
              Thiết bị
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19 9-7 7-7-7"/></svg>
            </button>
            <div class="dd-menu absolute left-0 mt-3 hidden">
              <div class="w-64 rounded-2xl border bg-white shadow-xl p-2">
                <a href="thietbi.html" class="block px-3 py-2 rounded-lg hover:bg-slate-100">Tất cả</a>
                <a href="thietbi.html?cat=cam-bien" class="block px-3 py-2 rounded-lg hover:bg-slate-100">Cảm biến</a>
                <a href="thietbi.html?cat=vi-dieu-khien" class="block px-3 py-2 rounded-lg hover:bg-slate-100">Vi điều khiển</a>
                <a href="thietbi.html?cat=man-hinh" class="block px-3 py-2 rounded-lg hover:bg-slate-100">Màn hình hiển thị</a>
                <a href="thietbi.html?cat=nguon-pin" class="block px-3 py-2 rounded-lg hover:bg-slate-100">Nguồn / Pin / Sạc</a>
                <a href="thietbi.html?cat=giam-ap" class="block px-3 py-2 rounded-lg hover:bg-slate-100">Module giảm áp</a>
                <a href="thietbi.html?cat=phu-kien" class="block px-3 py-2 rounded-lg hover:bg-slate-100">Phụ kiện</a>
              </div>
            </div>
          </div>

          <a href="kho.html" class="py-2 hover:text-sky-700">Kho thuốc</a>

          <div class="relative" data-dd="status">
            <button class="py-2 hover:text-sky-700 flex items-center gap-1 dd-toggle">
              Trạng thái
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19 9-7 7-7-7"/></svg>
            </button>
            <div class="dd-menu absolute left-0 mt-3 hidden">
              <div class="w-56 rounded-2xl border bg-white shadow-xl p-2">
                <a href="trangthai.html?view=now" class="block px-3 py-2 rounded-lg hover:bg-slate-100">Hiện giờ</a>
                <a href="trangthai.html?view=history" class="block px-3 py-2 rounded-lg hover:bg-slate-100">Lịch sử</a>
              </div>
            </div>
          </div>

          <a href="mini-dashboard.html" class="py-2 hover:text-sky-700">Mini dashboard</a>

          <div class="relative" data-dd="user">
            <button class="py-2 hover:text-sky-700 flex items-center gap-1 dd-toggle">
              Người dùng
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19 9-7 7-7-7"/></svg>
            </button>
            <div class="dd-menu absolute right-0 mt-3 hidden">
              <div class="w-56 rounded-2xl border bg-white shadow-xl p-2">
                <a href="user.html?tab=signup" class="block px-3 py-2 rounded-lg hover:bg-slate-100">Đăng ký</a>
                <a href="user.html?tab=signin" class="block px-3 py-2 rounded-lg hover:bg-slate-100">Đăng nhập</a>
              </div>
            </div>
          </div>
        </nav>

        <button id="btnMobile" class="md:hidden p-2 rounded-lg border border-slate-300" aria-label="Mở menu">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
        </button>
      </div>
    </div>

    <!-- Mobile menu -->
    <div id="mobileMenu" class="md:hidden hidden border-t border-slate-200 bg-white">
      <div class="max-w-screen-xl mx-auto px-4 py-3 space-y-1">
        <a href="index.html" class="block px-3 py-2 rounded-lg hover:bg-slate-100">Trang chủ</a>
        <details class="px-3 py-2 rounded-lg">
          <summary class="cursor-pointer select-none">Thiết bị</summary>
          <div class="mt-2 pl-3 space-y-1">
            <a href="thietbi.html" class="block py-1">• Tất cả</a>
            <a href="thietbi.html?cat=cam-bien" class="block py-1">• Cảm biến</a>
            <a href="thietbi.html?cat=vi-dieu-khien" class="block py-1">• Vi điều khiển</a>
            <a href="thietbi.html?cat=man-hinh" class="block py-1">• Màn hình hiển thị</a>
            <a href="thietbi.html?cat=nguon-pin" class="block py-1">• Nguồn / Pin / Sạc</a>
            <a href="thietbi.html?cat=giam-ap" class="block py-1">• Module giảm áp</a>
            <a href="thietbi.html?cat=phu-kien" class="block py-1">• Phụ kiện</a>
          </div>
        </details>
        <a href="kho.html" class="block px-3 py-2 rounded-lg hover:bg-slate-100">Kho thuốc</a>
        <details class="px-3 py-2 rounded-lg">
          <summary class="cursor-pointer select-none">Trạng thái</summary>
          <div class="mt-2 pl-3 space-y-1">
            <a href="trangthai.html?view=now" class="block py-1">• Hiện giờ</a>
            <a href="trangthai.html?view=history" class="block py-1">• Lịch sử</a>
          </div>
        </details>
        <a href="mini-dashboard.html" class="block px-3 py-2 rounded-lg hover:bg-slate-100">Mini dashboard</a>
        <details class="px-3 py-2 rounded-lg">
          <summary class="cursor-pointer select-none">Người dùng</summary>
          <div class="mt-2 pl-3 space-y-1">
            <a href="user.html?tab=signup" class="block py-1">• Đăng ký</a>
            <a href="user.html?tab=signin" class="block py-1">• Đăng nhập</a>
          </div>
        </details>
      </div>
    </div>
  </header>

  <!-- MAIN -->
  <main class="py-10 md:py-14">
    <div class="max-w-screen-xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="mb-6">
        <h1 class="text-2xl md:text-3xl font-semibold">Mini dashboard</h1>
        <p class="text-slate-600 mt-1">Xem nhanh các chỉ số của Medicate từ Looker Studio.</p>
      </div>

      <div class="rounded-2xl border border-slate-200 bg-white shadow-sm p-4 md:p-6">
        <!-- Controls -->
        <div class="flex items-center justify-between gap-3 flex-wrap mb-3">
          <div class="text-sm text-slate-500">Nguồn: Google Looker Studio</div>
          <div class="flex gap-2 flex-wrap items-center">
            <label class="text-sm text-slate-600">Chiều cao:</label>
            <select id="hSelect" class="border rounded-lg px-2 py-1 text-sm">
              <option value="480">480px</option>
              <option value="600" selected>600px</option>
              <option value="800">800px</option>
              <option value="1000">1000px</option>
            </select>

            <label class="text-sm text-slate-600 ml-2">Chế độ:</label>
            <select id="modeSelect" class="border rounded-lg px-2 py-1 text-sm">
              <option value="scroll" selected>Cuộn (không cắt)</option>
              <option value="crop">Crop (cắt bớt, không cuộn)</option>
            </select>

            <button id="btnReload" class="px-3 py-1.5 rounded-lg border border-slate-300 hover:bg-slate-50 text-sm">Reload</button>

            <label class="text-sm text-slate-600 ml-2">Auto-refresh:</label>
            <select id="autoSelect" class="border rounded-lg px-2 py-1 text-sm">
              <option value="0" selected>Tắt</option>
              <option value="30">30s</option>
              <option value="60">1 phút</option>
              <option value="300">5 phút</option>
            </select>

            <a id="openNewTab" href="#" target="_blank" rel="noopener" class="px-3 py-1.5 rounded-lg border border-slate-300 hover:bg-slate-50 text-sm">Mở tab mới</a>
            <button id="btnFullscreen" class="px-3 py-1.5 rounded-lg border border-slate-300 hover:bg-slate-50 text-sm">Toàn màn hình</button>
          </div>
        </div>

        <!-- Wrapper có thể SCROLL hoặc CROP -->
        <div id="reportWrap" class="relative w-full overflow-auto rounded-xl bg-slate-100" style="height: 600px;">
          <!-- IFRAME sẽ được gắn bằng JS -->
          <div id="reportFallback" class="absolute inset-0 grid place-items-center text-slate-500">
            Đang tải dashboard…
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- FOOTER (giữ nguyên) -->
  <footer class="mt-16 border-t border-slate-200 bg-white">
    <div class="max-w-screen-xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
      <div class="grid md:grid-cols-4 gap-8">
        <div>
          <div class="flex items-center gap-2 font-semibold">
            <img src="assets/img/logo-mark.svg" alt="Medicate" class="h-8 w-8 rounded-full" onerror="this.outerHTML='<span class=&quot;inline-flex h-8 w-8 items-center justify-center rounded-lg bg-sky-600 text-white&quot;>M</span>'">
            <span>Medicate</span>
          </div>
          <p class="text-sm mt-3 text-slate-600">Tủ thuốc thông minh: cảm biến nhiệt/ẩm, quản lý theo lô, AI tư vấn.</p>
        </div>
        <div>
          <div class="font-medium mb-2">Liên kết</div>
          <ul class="space-y-1 text-sm">
            <li><a class="hover:text-sky-700" href="kho.html">Kho thuốc</a></li>
            <li><a class="hover:text-sky-700" href="trangthai.html?view=now">Trạng thái – Hiện giờ</a></li>
            <li><a class="hover:text-sky-700" href="trangthai.html?view=history">Trạng thái – Lịch sử</a></li>
            <li><a class="hover:text-sky-700" href="mini-dashboard.html">Mini dashboard</a></li>
          </ul>
        </div>
        <div>
          <div class="font-medium mb-2">Tài liệu</div>
          <ul class="space-y-1 text-sm">
            <li><a class="hover:text-sky-700" href="#">Hướng dẫn sử dụng</a></li>
            <li><a class="hover:text-sky-700" href="#">Nguồn & Credits</a></li>
          </ul>
        </div>
        <div>
          <div class="font-medium mb-2">Liên hệ</div>
          <ul class="space-y-1 text-sm">
            <li>Email: <a class="hover:text-sky-700" href="mailto:contact@medicate.com.vn">contact@medicate.com.vn</a></li>
          </ul>
        </div>
      </div>
      <p class="mt-8 text-xs text-slate-500">⚠️ Thông tin dược chỉ mang tính tham khảo — hãy hỏi ý kiến bác sĩ/DS khi cần.</p>
    </div>
  </footer>

  <!-- JS dùng chung -->
  <script src="assets/js/nav.js"></script>

  <!-- Nhúng Looker Studio + điều khiển height/crop/reload -->
  <script>
    // URL Looker Studio của bạn (embed URL) — GIỮ NGUYÊN THEO FILE BẠN GỬI
    const LOOKER_URL_DEFAULT = "https://lookerstudio.google.com/embed/reporting/f79f2b5e-2d57-4988-9348-27466825c946/page/kkKTF";

    const qp = new URLSearchParams(location.search);
    const LOOKER_URL = qp.get("src") || LOOKER_URL_DEFAULT;

    let autoTimer = null;
    let iframe = null;

    function mountIframe(bust = false){
      const wrap = document.getElementById("reportWrap");
      const fallback = document.getElementById("reportFallback");
      if (!iframe) {
        iframe = document.createElement("iframe");
        iframe.className = "absolute inset-0 w-full h-full";
        iframe.setAttribute("frameborder", "0");
        iframe.setAttribute("allowfullscreen", "");
        iframe.referrerPolicy = "no-referrer-when-downgrade";
        wrap.style.position = "relative";
        const layer = document.createElement("div");
        layer.className = "absolute inset-0";
        wrap.appendChild(layer);
        layer.appendChild(iframe);
      }
      const url = LOOKER_URL + (bust ? (LOOKER_URL.includes("?") ? "&" : "?") + "_ts=" + Date.now() : "");
      iframe.src = url;
      iframe.onload = () => fallback?.remove();

      document.getElementById("openNewTab").href = LOOKER_URL;
      document.getElementById("btnFullscreen").onclick = () => {
        if (wrap.requestFullscreen) wrap.requestFullscreen();
        else if (wrap.webkitRequestFullscreen) wrap.webkitRequestFullscreen();
      };
    }

    function applyViewOptions(){
      const wrap = document.getElementById("reportWrap");
      const h = parseInt(document.getElementById("hSelect").value, 10);
      const mode = document.getElementById("modeSelect").value; // 'scroll' | 'crop'
      wrap.style.height = h + "px";
      wrap.style.overflow = (mode === "crop") ? "hidden" : "auto";
    }

    function setAutoRefresh(seconds){
      if (autoTimer) { clearInterval(autoTimer); autoTimer = null; }
      if (seconds > 0) {
        autoTimer = setInterval(() => mountIframe(true), seconds * 1000);
      }
    }

    (function init(){
      mountIframe(false);
      applyViewOptions();

      document.getElementById("hSelect").addEventListener("change", applyViewOptions);
      document.getElementById("modeSelect").addEventListener("change", applyViewOptions);

      document.getElementById("btnReload").addEventListener("click", () => mountIframe(true));
      document.getElementById("autoSelect").addEventListener("change", (e) => {
        setAutoRefresh(parseInt(e.target.value, 10) || 0);
      });
    })();
  </script>
</body>
</html>
