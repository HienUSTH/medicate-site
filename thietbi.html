<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Thiết bị • Medicate</title>
  <meta name="description" content="Danh mục thiết bị phần cứng cho dự án Medicate." />
  <!-- FAVICONS (put this inside <head> on every page) -->
  <link rel="icon" href="assets/img/favicon.png">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    details > summary::-webkit-details-marker{display:none}
    .summary-btn{list-style:none}
  </style>
</head>
<body class="bg-slate-50 text-slate-800">

  <!-- ===== HEADER ===== -->
  <header class="sticky top-0 z-50 bg-white/90 backdrop-blur border-b border-slate-200">
    <div class="max-w-screen-xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <a href="index.html" class="flex items-center gap-2 font-semibold">
          <img src="assets/img/favicon.png" alt="Medicate" class="h-10 w-10" />
          <span class="text-lg">Medicate</span>
        </a>

        <nav class="hidden md:flex items-center gap-6">
          <a href="index.html" class="py-2 hover:text-sky-700">Trang chủ</a>

          <div class="relative" data-dd="devices">
            <button class="py-2 hover:text-sky-700 flex items-center gap-1 dd-toggle">
              Thiết bị
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19 9-7 7-7-7"/></svg>
            </button>
            <div class="dd-menu absolute left-0 mt-3 hidden">
              <div class="w-64 rounded-2xl border bg-white shadow-xl p-2">
                <a href="thietbi.html" class="block px-3 py-2 rounded-lg hover:bg-slate-100">Tất cả</a>
                <a href="thietbi.html?cat=cam-bien" class="block px-3 py-2 rounded-lg hover:bg-slate-100">Cảm biến</a>
                <a href="thietbi.html?cat=vi-dieu-khien" class="block px-3 py-2 rounded-lg hover:bg-slate-100">Vi điều khiển</a>
                <a href="thietbi.html?cat=man-hinh" class="block px-3 py-2 rounded-lg hover:bg-slate-100">Màn hình hiển thị</a>
                <a href="thietbi.html?cat=nguon-pin" class="block px-3 py-2 rounded-lg hover:bg-slate-100">Nguồn / Pin / Sạc</a>
                <a href="thietbi.html?cat=giam-ap" class="block px-3 py-2 rounded-lg hover:bg-slate-100">Module giảm áp</a>
                <a href="thietbi.html?cat=phu-kien" class="block px-3 py-2 rounded-lg hover:bg-slate-100">Phụ kiện</a>
              </div>
            </div>
          </div>

          <a href="kho.html" class="py-2 hover:text-sky-700">Kho thuốc</a>

          <div class="relative" data-dd="status">
            <button class="py-2 hover:text-sky-700 flex items-center gap-1 dd-toggle">
              Trạng thái
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19 9-7 7-7-7"/></svg>
            </button>
            <div class="dd-menu absolute left-0 mt-3 hidden">
              <div class="w-56 rounded-2xl border bg-white shadow-xl p-2">
                <a href="trangthai.html?view=now" class="block px-3 py-2 rounded-lg hover:bg-slate-100">Hiện giờ</a>
                <a href="trangthai.html?view=history" class="block px-3 py-2 rounded-lg hover:bg-slate-100">Lịch sử</a>
              </div>
            </div>
          </div>

          <a href="mini-dashboard.html" class="py-2 hover:text-sky-700">Mini dashboard</a>

          <div class="relative" data-dd="user">
            <button class="py-2 hover:text-sky-700 flex items-center gap-1 dd-toggle">
              Người dùng
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19 9-7 7-7-7"/></svg>
            </button>
            <div class="dd-menu absolute right-0 mt-3 hidden">
              <div class="w-56 rounded-2xl border bg-white shadow-xl p-2">
                <a href="user.html?tab=signup" class="block px-3 py-2 rounded-lg hover:bg-slate-100">Đăng ký</a>
                <a href="user.html?tab=signin" class="block px-3 py-2 rounded-lg hover:bg-slate-100">Đăng nhập</a>
              </div>
            </div>
          </div>
        </nav>

        <button id="btnMobile" class="md:hidden p-2 rounded-lg border border-slate-300" aria-label="Mở menu">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
        </button>
      </div>
    </div>

    <div id="mobileMenu" class="md:hidden hidden border-t border-slate-200 bg-white">
      <div class="max-w-screen-xl mx-auto px-4 py-3 space-y-1">
        <a href="index.html" class="block px-3 py-2 rounded-lg hover:bg-slate-100">Trang chủ</a>
        <details class="px-3 py-2 rounded-lg">
          <summary class="cursor-pointer select-none">Thiết bị</summary>
          <div class="mt-2 pl-3 space-y-1">
            <a href="thietbi.html" class="block py-1">• Tất cả</a>
            <a href="thietbi.html?cat=cam-bien" class="block py-1">• Cảm biến</a>
            <a href="thietbi.html?cat=vi-dieu-khien" class="block py-1">• Vi điều khiển</a>
            <a href="thietbi.html?cat=man-hinh" class="block py-1">• Màn hình hiển thị</a>
            <a href="thietbi.html?cat=nguon-pin" class="block py-1">• Nguồn / Pin / Sạc</a>
            <a href="thietbi.html?cat=giam-ap" class="block py-1">• Module giảm áp</a>
            <a href="thietbi.html?cat=phu-kien" class="block py-1">• Phụ kiện</a>
          </div>
        </details>
        <a href="kho.html" class="block px-3 py-2 rounded-lg hover:bg-slate-100">Kho thuốc</a>
        <details class="px-3 py-2 rounded-lg">
          <summary class="cursor-pointer select-none">Trạng thái</summary>
          <div class="mt-2 pl-3 space-y-1">
            <a href="trangthai.html?view=now" class="block py-1">• Hiện giờ</a>
            <a href="trangthai.html?view=history" class="block py-1">• Lịch sử</a>
          </div>
        </details>
        <a href="mini-dashboard.html" class="block px-3 py-2 rounded-lg hover:bg-slate-100">Mini dashboard</a>
        <details class="px-3 py-2 rounded-lg">
          <summary class="cursor-pointer select-none">Người dùng</summary>
          <div class="mt-2 pl-3 space-y-1">
            <a href="user.html?tab=signup" class="block py-1">• Đăng ký</a>
            <a href="user.html?tab=signin" class="block py-1">• Đăng nhập</a>
          </div>
        </details>
      </div>
    </div>
  </header>
  <!-- ===== /HEADER ===== -->

  <main class="max-w-screen-xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
    <div class="flex flex-wrap items-end justify-between gap-4">
      <div>
        <h1 class="text-2xl md:text-3xl font-semibold">Thiết bị</h1>
        <p class="mt-1 text-slate-600">Bấm từng mục để xem mô tả & danh sách thiết bị. Có thể thêm/sửa/xoá, ghi chú và tạo sơ đồ khối.</p>
      </div>
      <div class="flex gap-2">
        <div class="w-64">
          <label class="sr-only" for="dev-search">Tìm thiết bị</label>
          <div class="relative">
            <input id="dev-search" type="search" placeholder="Tìm theo tên/thông số…"
              class="w-full rounded-xl border border-slate-300 bg-white px-4 py-2.5 pr-10 focus:outline-none focus:ring-2 focus:ring-sky-500">
            <svg class="absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m21 21-4.35-4.35M17 11a6 6 0 1 1-12 0 6 6 0 0 1 12 0Z"/>
            </svg>
          </div>
        </div>
        <button id="btnAddDevice" class="px-3 py-2 rounded-lg bg-emerald-600 text-white hover:bg-emerald-700">+ Thêm thiết bị</button>
        <button id="btnTrash" class="px-3 py-2 rounded-lg border border-slate-300 hover:bg-slate-50">Thùng rác</button>
        <a href="#diagram" class="px-3 py-2 rounded-lg border border-slate-300 hover:bg-slate-50">Mở Block Diagram</a>
      </div>
    </div>

    <!-- Accordions -->
    <section id="device-accordions" class="mt-6 space-y-4"></section>

    <!-- ===== Block Diagram (đa bản vẽ) ===== -->
    <section id="diagram" class="mt-12">
      <div class="flex items-center justify-between gap-3 flex-wrap">
        <h2 class="text-xl font-semibold">Block Diagram</h2>
        <div class="flex items-center gap-2 flex-wrap">
          <select id="diagramSelect" class="rounded-lg border border-slate-300 px-3 py-2"></select>
          <button id="btnDiagramNew" class="px-3 py-2 rounded-lg border border-slate-300 hover:bg-slate-50">Mới</button>
          <button id="btnDiagramRename" class="px-3 py-2 rounded-lg border border-slate-300 hover:bg-slate-50">Đổi tên</button>
          <button id="btnDiagramSave" class="px-3 py-2 rounded-lg bg-sky-600 text-white hover:bg-sky-700">Lưu</button>
          <button id="btnDiagramDelete" class="px-3 py-2 rounded-lg border border-rose-300 text-rose-700 hover:bg-rose-50">Xóa vào thùng rác</button>
          <button id="btnDiagramTrash" class="px-3 py-2 rounded-lg border border-slate-300 hover:bg-slate-50">Thùng rác sơ đồ</button>
          <button id="btnDiagramConnect" class="px-3 py-2 rounded-lg border border-slate-300 hover:bg-slate-50" title="Click nút này rồi chọn 2 node để nối">Chế độ nối</button>
          <button id="btnDiagramAddSelected" class="px-3 py-2 rounded-lg border border-slate-300 hover:bg-slate-50">Thêm từ lựa chọn</button>
          <button id="btnDiagramClear" class="px-3 py-2 rounded-lg border border-rose-300 text-rose-700 hover:bg-rose-50">Xóa sạch canvas</button>
        </div>
      </div>
      <p class="text-slate-600 text-sm mt-1">Mỗi sơ đồ có tên riêng và lưu độc lập. Kéo thả node, nối, đặt nhãn.</p>

      <div class="mt-3 rounded-2xl border border-slate-300 bg-white overflow-hidden">
        <div id="diagramCanvasWrap" class="h-[520px] relative">
          <svg id="diagramCanvas" viewBox="0 0 1200 700" class="w-full h-full"></svg>
        </div>
      </div>
    </section>
  </main>

  <!-- ===== FOOTER ===== -->
  <footer class="mt-16 border-t border-slate-200 bg-white">
    <div class="max-w-screen-xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
      <div class="grid md:grid-cols-4 gap-8">
        <div>
          <div class="flex items-center gap-2 font-semibold">
            <img src="assets/img/favicon.png" alt="Medicate" class="h-10 w-10"/>
            <span>Medicate</span>
          </div>
          <p class="text-sm mt-3 text-slate-600">Tủ thuốc thông minh: cảm biến nhiệt/ẩm, quản lý theo lô, AI tư vấn.</p>
        </div>
        <div>
          <div class="font-medium mb-2">Liên kết</div>
          <ul class="space-y-1 text-sm">
            <li><a class="hover:text-sky-700" href="kho.html">Kho thuốc</a></li>
            <li><a class="hover:text-sky-700" href="trangthai.html?view=now">Trạng thái – Hiện giờ</a></li>
            <li><a class="hover:text-sky-700" href="trangthai.html?view=history">Trạng thái – Lịch sử</a></li>
            <li><a class="hover:text-sky-700" href="mini-dashboard.html">Mini dashboard</a></li>
          </ul>
        </div>
        <div>
          <div class="font-medium mb-2">Tài liệu</div>
          <ul class="space-y-1 text-sm">
            <li><a class="hover:text-sky-700" href="#">Hướng dẫn sử dụng</a></li>
            <li><a class="hover:text-sky-700" href="#">Nguồn & Credits</a></li>
          </ul>
        </div>
        <div>
          <div class="font-medium mb-2">Liên hệ</div>
          <ul class="space-y-1 text-sm">
            <li>Email: <a class="hover:text-sky-700" href="mailto:contact@medicate.com.vn">contact@medicate.com.vn</a></li>
          </ul>
        </div>
      </div>
      <p class="mt-8 text-xs text-slate-500">⚠️ Thông tin dược chỉ mang tính tham khảo — hãy hỏi ý kiến bác sĩ/DS khi cần.</p>
    </div>
  </footer>

  <!-- Modal thêm/sửa thiết bị -->
  <dialog id="dlgAdd" class="rounded-2xl p-0 w-[min(680px,90vw)] border border-slate-300">
    <form method="dialog">
      <div class="p-5 border-b">
        <div id="dlgTitle" class="text-lg font-semibold">Thêm thiết bị</div>
        <p class="text-sm text-slate-600">“Nguồn mua” hiển thị ngay dưới thông số. Nếu có URL, sẽ tự hiển thị dưới dạng link.</p>
      </div>
      <div class="p-5 grid gap-3">
        <input id="fId" type="hidden" />
        <input id="fMode" type="hidden" />
        <input id="fBaseCat" type="hidden" />
        <input id="fBaseName" type="hidden" />
        <div>
          <label class="text-sm">Danh mục</label>
          <select id="fCat" class="mt-1 w-full rounded-lg border border-slate-300 p-2.5"></select>
        </div>
        <div>
          <label class="text-sm">Tên thiết bị</label>
          <input id="fName" class="mt-1 w-full rounded-lg border border-slate-300 p-2.5" required />
        </div>
        <div class="grid md:grid-cols-2 gap-3">
          <div>
            <label class="text-sm">Ảnh (URL, .jpg/.png/...)</label>
            <input id="fImg" class="mt-1 w-full rounded-lg border border-slate-300 p-2.5" placeholder="https://example.com/image.jpg" />
          </div>
          <!-- Upload ảnh từ máy (tuỳ chọn) -->
          <div class="mt-2">
            <label class="text-sm">Hoặc chọn ảnh từ máy</label>
            <input id="fImgFile" type="file" accept="image/*"
                  class="mt-1 w-full rounded-lg border border-slate-300 p-2.5" />
            <div id="fImgPreview" class="mt-2 text-xs text-slate-500"></div>
            <p class="text-xs text-slate-500 mt-1">
              Nếu chọn file, hệ thống sẽ ưu tiên ảnh upload; nếu không, sẽ dùng URL ảnh bên trên.
            </p>
          </div>
          <div class="flex items-center gap-2 mt-2">
            <button id="btnClearImg" type="button"
                    class="px-3 py-1.5 text-sm rounded-lg border border-slate-300 hover:bg-slate-50">
              Xóa ảnh
            </button>
            <span class="text-xs text-slate-500">Sẽ bỏ URL & file upload (nếu có)</span>
          </div>
          <div>
            <label class="text-sm">Trang thông tin / Datasheet (URL)</label>
            <input id="fUrl" class="mt-1 w-full rounded-lg border border-slate-300 p-2.5" placeholder="https://..." />
          </div>
        </div>
        <div class="grid md:grid-cols-2 gap-3">
          <!-- Hiển thị nguồn mua (gốc) read-only -->
          <div id="fBaseVendorView" class="text-sm text-slate-600">
            <!-- sẽ được JS set khi mở dialog -->
          </div>
          <div>
            <label class="text-sm">Nguồn mua (tên)</label>
            <input id="fVendorName" class="mt-1 w-full rounded-lg border border-slate-300 p-2.5" placeholder="Shopee/Tiki/Hãng..." />
          </div>
          <div>
            <label class="text-sm">Link mua (URL, tuỳ chọn)</label>
            <input id="fVendorUrl" class="mt-1 w-full rounded-lg border border-slate-300 p-2.5" placeholder="https://..." />
          </div>
        </div>
        <div>
          <label class="text-sm">Thông số (mỗi dòng là 1 bullet)</label>
          <textarea id="fSpecs" rows="4" class="mt-1 w-full rounded-lg border border-slate-300 p-2.5" placeholder="Ví dụ:
Wi-Fi 2.4GHz
Bluetooth BLE
GPIO SPI/I2C/UART"></textarea>
        </div>
      </div>
      <div class="p-5 border-t flex justify-between gap-2">
        <button id="btnDlgDelete" class="hidden px-3 py-2 rounded-lg border border-rose-300 text-rose-700">Xóa/Ẩn</button>
        <div class="ml-auto flex gap-2">
          <button id="btnDlgRestore" class="hidden px-3 py-2 rounded-lg border border-amber-300 text-amber-700">Hiện lại</button>
          <button id="btnDlgCancel" class="px-3 py-2 rounded-lg border border-slate-300">Hủy</button>
          <button id="btnDlgSave" class="px-3 py-2 rounded-lg bg-emerald-600 text-white">Lưu</button>
        </div>
      </div>
    </form>
  </dialog>

  <!-- Modal thùng rác thiết bị -->
  <dialog id="dlgTrash" class="rounded-2xl p-0 w-[min(700px,90vw)] border border-slate-300">
    <div class="p-5 border-b">
      <div class="text-lg font-semibold">Thùng rác thiết bị</div>
      <p class="text-sm text-slate-600">Khôi phục hoặc xóa vĩnh viễn.</p>
    </div>
    <div class="p-5" id="trashList"></div>
    <div class="p-5 border-t text-right">
      <button id="btnTrashClose" class="px-3 py-2 rounded-lg border border-slate-300">Đóng</button>
    </div>
  </dialog>

  <!-- Modal thùng rác sơ đồ -->
  <dialog id="dlgDiagramTrash" class="rounded-2xl p-0 w-[min(700px,90vw)] border border-slate-300">
    <div class="p-5 border-b">
      <div class="text-lg font-semibold">Thùng rác sơ đồ</div>
      <p class="text-sm text-slate-600">Các sơ đồ đã xóa. Có thể khôi phục hoặc xóa vĩnh viễn.</p>
    </div>
    <div class="p-5" id="diagramTrashList"></div>
    <div class="p-5 border-t text-right">
      <button id="btnDiagramTrashClose" class="px-3 py-2 rounded-lg border border-slate-300">Đóng</button>
    </div>
  </dialog>

  <!-- Toast/Undo -->
  <div id="toast" class="fixed bottom-4 right-4 hidden"></div>

  <script src="assets/js/nav.js"></script>
  <script src="assets/js/status-watcher.js"></script>
  <script src="assets/js/reminder-watcher.js"></script>
  <script src="assets/js/thietbi.js"></script>
</body>
</html>
