<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kho thuốc • Medicate</title>
  <!-- FAVICONS (put this inside <head> on every page) -->
  <link rel="icon" href="assets/img/favicon.png">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Slider màu */
    input[type="range"].qty-range{
      -webkit-appearance:none;appearance:none;width:220px;height:10px;border-radius:999px;
      background:linear-gradient(90deg,#7dd3fc,#34d399);outline:none;opacity:.95;
    }
    input[type="range"].qty-range::-webkit-slider-thumb{
      -webkit-appearance:none;appearance:none;width:18px;height:18px;border-radius:999px;background:#fff;
      border:2px solid #0284c7;box-shadow:0 1px 4px rgba(2,132,199,.35);cursor:pointer;
    }
    input[type="range"].qty-range::-moz-range-thumb{
      width:18px;height:18px;border-radius:999px;background:#fff;border:2px solid #0284c7;cursor:pointer;
    }
    .chat-bubble{max-width:85%;border-radius:16px;padding:10px 12px}
    .chat-user{background:#e0f2fe;border:1px solid #bae6fd}
    .chat-bot {background:#f8fafc;border:1px solid #e2e8f0}
    .mono{font-variant-numeric:tabular-nums}
    .segmented>button{border:1px solid #cbd5e1}
    .segmented>button:first-child{border-radius:999px 0 0 999px}
    .segmented>button:last-child{border-radius:0 999px 999px 0;margin-left:-1px}
    .segmented>button[aria-pressed="true"]{background:#0ea5e9;color:#fff;border-color:#0ea5e9}
    .segmented>button[disabled]{opacity:.5;cursor:not-allowed}
  </style>
</head>
<body class="bg-slate-50 text-slate-800">

  <!-- NAVBAR (giống index – không thay đổi kích thước) -->
  <header class="sticky top-0 z-50 bg-white/90 backdrop-blur border-b border-slate-200">
    <div class="max-w-screen-xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <a href="index.html" class="flex items-center gap-2 font-semibold">
          <img src="assets/img/favicon.png" alt="Medicate" class="h-10 w-10" />
          <span class="text-lg">Medicate</span>
        </a>

        <nav class="hidden md:flex items-center gap-6">
          <a href="index.html" class="py-2 hover:text-sky-700">Trang chủ</a>

          <div class="relative" data-dd="devices">
            <button class="py-2 hover:text-sky-700 flex items-center gap-1 dd-toggle">Thiết bị
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19 9-7 7-7-7"/></svg>
            </button>
            <div class="dd-menu absolute left-0 mt-3 hidden">
              <div class="w-64 rounded-2xl border bg-white shadow-xl p-2">
                <a href="thietbi.html" class="block px-3 py-2 rounded-lg hover:bg-slate-100">Tất cả</a>
                <a href="thietbi.html?cat=cam-bien" class="block px-3 py-2 rounded-lg hover:bg-slate-100">Cảm biến</a>
                <a href="thietbi.html?cat=vi-dieu-khien" class="block px-3 py-2 rounded-lg hover:bg-slate-100">Vi điều khiển</a>
                <a href="thietbi.html?cat=man-hinh" class="block px-3 py-2 rounded-lg hover:bg-slate-100">Màn hình hiển thị</a>
                <a href="thietbi.html?cat=nguon-pin" class="block px-3 py-2 rounded-lg hover:bg-slate-100">Nguồn / Pin / Sạc</a>
                <a href="thietbi.html?cat=giam-ap" class="block px-3 py-2 rounded-lg hover:bg-slate-100">Module giảm áp</a>
                <a href="thietbi.html?cat=phu-kien" class="block px-3 py-2 rounded-lg hover:bg-slate-100">Phụ kiện</a>
              </div>
            </div>
          </div>

          <a href="kho.html" class="py-2 text-sky-700 font-medium">Kho thuốc</a>

          <div class="relative" data-dd="status">
            <button class="py-2 hover:text-sky-700 flex items-center gap-1 dd-toggle">Trạng thái
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19 9-7 7-7-7"/></svg>
            </button>
            <div class="dd-menu absolute left-0 mt-3 hidden">
              <div class="w-56 rounded-2xl border bg-white shadow-xl p-2">
                <a href="trangthai.html?view=now" class="block px-3 py-2 rounded-lg hover:bg-slate-100">Hiện giờ</a>
                <a href="trangthai.html?view=history" class="block px-3 py-2 rounded-lg hover:bg-slate-100">Lịch sử</a>
              </div>
            </div>
          </div>

          <a href="mini-dashboard.html" class="py-2 hover:text-sky-700">Mini dashboard</a>

          <div class="relative" data-dd="user">
            <button class="py-2 hover:text-sky-700 flex items-center gap-1 dd-toggle">Người dùng
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19 9-7 7-7-7"/></svg>
            </button>
            <div class="dd-menu absolute right-0 mt-3 hidden">
              <div class="w-56 rounded-2xl border bg-white shadow-xl p-2">
                <a href="user.html?tab=signup" class="block px-3 py-2 rounded-lg hover:bg-slate-100">Đăng ký</a>
                <a href="user.html?tab=signin" class="block px-3 py-2 rounded-lg hover:bg-slate-100">Đăng nhập</a>
              </div>
            </div>
          </div>
        </nav>

        <button id="btnMobile" class="md:hidden p-2 rounded-lg border border-slate-300" aria-label="Mở menu">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
        </button>
      </div>
    </div>

    <!-- Mobile menu -->
    <div id="mobileMenu" class="md:hidden hidden border-t border-slate-200 bg-white">
      <div class="max-w-screen-xl mx-auto px-4 py-3 space-y-1">
        <a href="index.html" class="block px-3 py-2 rounded-lg hover:bg-slate-100">Trang chủ</a>
        <details class="px-3 py-2 rounded-lg">
          <summary class="cursor-pointer select-none">Thiết bị</summary>
          <div class="mt-2 pl-3 space-y-1">
            <a href="thietbi.html" class="block py-1">• Tất cả</a>
            <a href="thietbi.html?cat=cam-bien" class="block py-1">• Cảm biến</a>
            <a href="thietbi.html?cat=vi-dieu-khien" class="block py-1">• Vi điều khiển</a>
            <a href="thietbi.html?cat=man-hinh" class="block py-1">• Màn hình hiển thị</a>
            <a href="thietbi.html?cat=nguon-pin" class="block py-1">• Nguồn / Pin / Sạc</a>
            <a href="thietbi.html?cat=giam-ap" class="block py-1">• Module giảm áp</a>
            <a href="thietbi.html?cat=phu-kien" class="block py-1">• Phụ kiện</a>
          </div>
        </details>
        <a href="kho.html" class="block px-3 py-2 rounded-lg bg-sky-50">Kho thuốc</a>
        <details class="px-3 py-2 rounded-lg">
          <summary class="cursor-pointer select-none">Trạng thái</summary>
          <div class="mt-2 pl-3 space-y-1">
            <a href="trangthai.html?view=now" class="block py-1">• Hiện giờ</a>
            <a href="trangthai.html?view=history" class="block py-1">• Lịch sử</a>
          </div>
        </details>
        <a href="mini-dashboard.html" class="block px-3 py-2 rounded-lg hover:bg-slate-100">Mini dashboard</a>
        <details class="px-3 py-2 rounded-lg">
          <summary class="cursor-pointer select-none">Người dùng</summary>
          <div class="mt-2 pl-3 space-y-1">
            <a href="user.html?tab=signup" class="block py-1">• Đăng ký</a>
            <a href="user.html?tab=signin" class="block py-1">• Đăng nhập</a>
          </div>
        </details>
      </div>
    </div>
  </header>

  <!-- MAIN (mở rộng phần thân, KHÔNG đổi header) -->
  <main class="max-w-screen-2xl mx-auto px-3 sm:px-5 lg:px-6 py-6 grid grid-cols-1 lg:grid-cols-[1fr_380px] gap-6">
    <!-- LEFT -->
    <section class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
      <div class="p-4 border-b border-slate-200 flex flex-wrap items-center gap-3">
        <div class="text-lg font-semibold">Kho thuốc</div>

        <!-- Slider SL -->
        <div class="flex items-center gap-2 ml-2">
          <span class="text-sm text-slate-600">SL ≤</span>
          <input id="qtySlider" class="qty-range" type="range" min="0" max="10" value="10" step="1" />
          <span id="qtyVal" class="text-sm font-medium mono">10</span>
        </div>

        <div class="ml-auto w-full max-w-xs">
          <input id="searchInput" type="search" placeholder="Tìm theo tên/alias..."
                 class="w-full px-3 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring focus:ring-sky-200" />
        </div>
      </div>

      <!-- FILTER BAR -->
      <div class="p-3 border-b border-slate-200 flex flex-wrap gap-2">
        <!-- “Tất cả” mặc định viền xanh & hover xanh -->
        <button data-filter="all"     class="filter-chip px-3 py-1.5 rounded-full border text-sm border-sky-300 hover:bg-sky-50">Tất cả</button>
        <button data-filter="ok"      class="filter-chip px-3 py-1.5 rounded-full border text-sm border-emerald-300 hover:bg-emerald-50">Còn hạn</button>
        <button data-filter="soon"    class="filter-chip px-3 py-1.5 rounded-full border text-sm border-amber-300 hover:bg-amber-50">Sắp hết hạn</button>
        <button data-filter="expired" class="filter-chip px-3 py-1.5 rounded-full border text-sm border-rose-300 hover:bg-rose-50">Hết hạn</button>
      </div>

      <!-- TABLE -->
      <div class="overflow-x-auto">
        <table class="min-w-full text-[13.5px] table-auto">
          <colgroup>
            <col style="width: 30%" />
            <col style="width: 22%" />
            <col style="width: 10%" />
            <col style="width: 12%" />
            <col style="width: 12%" />
            <col style="width: 9%" />
            <col style="width: 8%" />
          </colgroup>
          <thead class="bg-slate-100 text-slate-700 border-b border-slate-200">
            <tr>
              <th class="py-2.5 px-3 text-left font-medium">Tên thuốc gốc</th>
              <th class="py-2.5 px-3 text-left font-medium">Alias</th>
              <th class="py-2.5 px-3 text-right font-medium">Số lượng</th>
              <th class="py-2.5 px-3 text-left font-medium">HSD</th>
              <th class="py-2.5 px-3 text-left font-medium">Ngày nhập</th>
              <th class="py-2.5 px-3 text-center font-medium">Trạng thái</th>
              <th class="py-2.5 px-3 text-right font-medium">Còn<br>(ngày)</th>
            </tr>
          </thead>
          <tbody id="tableBody" class="divide-y divide-slate-100"></tbody>
        </table>
      </div>

      <div class="p-4 text-xs text-slate-500">
        * Dữ liệu đọc từ Google Sheets (read-only). Thông tin dược chỉ mang tính tham khảo, không thay thế tư vấn y tế.
      </div>
    </section>

    <!-- RIGHT -->
    <aside class="bg-white rounded-2xl shadow-sm border border-slate-200 p-4 h-fit sticky top-20">
      <!-- Catalog -->
      <div class="text-base font-semibold mb-2">Danh mục thuốc nội phổ biến</div>
      <div class="text-sm text-slate-600 mb-3">Mục đã có trong tủ sẽ tô nền xanh.</div>
      <div class="flex items-center gap-2 mb-3">
        <button id="btnToggleMissing" class="px-3 py-2 rounded-lg border border-slate-300 hover:bg-slate-50">Xem mục thiếu</button>
        <span id="coverageBadge" class="ml-auto text-xs px-2 py-1 rounded-full bg-slate-100">Coverage: …</span>
      </div>
      <div id="catalogList" class="max-h-[28vh] overflow-auto space-y-1 text-sm"></div>

      <hr class="my-4">

      <!-- Chatbot switch -->
      <div class="flex items-center justify-between">
        <div class="text-base font-semibold">Trợ lý</div>
        <div class="segmented inline-flex rounded-full overflow-hidden">
          <button id="tabKho"  type="button" class="px-3 py-1.5 text-sm" aria-pressed="true">Tủ thuốc</button>
          <button id="tabThuoc" type="button" class="px-3 py-1.5 text-sm" aria-pressed="false">Tra cứu thuốc</button>
        </div>
      </div>

      <!-- Chatbot: Hỏi kho -->
      <div id="chatKho" class="mt-3 space-y-3">
        <div class="text-sm text-slate-600">Hỏi bất cứ điều gì về kho: SL, HSD, trạng thái…</div>

        <!-- Quick prompts -->
        <div class="flex flex-wrap gap-2">
          <button class="chip-q px-3 py-1.5 rounded-full border border-slate-300 text-sm hover:bg-slate-50" data-q="sắp hết hạn trong 30 ngày">SHH 30 ngày</button>
          <button id="chipRandOne" class="chip-q px-3 py-1.5 rounded-full border border-slate-300 text-sm hover:bg-slate-50" data-q="">Tên ngẫu nhiên: SL, HSD</button>
          <button id="chipRandPair" class="chip-q px-3 py-1.5 rounded-full border border-slate-300 text-sm hover:bg-slate-50" data-q="">Ngẫu nhiên 2 tên</button>
        </div>

        <!-- Composer -->
        <div class="flex items-start gap-2">
          <textarea id="chatInput" rows="2" placeholder="Nhập câu hỏi" class="flex-1 px-3 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring focus:ring-sky-200"></textarea>
          <button id="btnSend" class="px-3 py-2 rounded-lg bg-sky-600 text-white hover:bg-sky-700">Gửi</button>
        </div>

        <!-- Conversation (scroll riêng) -->
        <div id="chatList" class="space-y-3 max-h-[46vh] overflow-y-auto pr-1"></div>
      </div>

      <!-- Chatbot Thuốc (UI được dựng bởi thuoc.js khi bật tab) -->
      <div id="chatThuoc" class="hidden mt-3"></div>
    </aside>
  </main>

  <footer class="mt-4 border-t border-slate-200 bg-white">
    <div class="max-w-screen-2xl mx-auto px-3 sm:px-5 lg:px-6 py-6">
      <p class="text-xs text-slate-500">
        ⚠️ Thông tin dược chỉ mang tính tham khảo — hãy hỏi ý kiến bác sĩ/DS khi cần.
      </p>
    </div>
  </footer>

  <script src="assets/js/nav.js"></script>
  <script src="https://unpkg.com/dayjs/dayjs.min.js"></script>
  <script src="https://unpkg.com/dayjs/plugin/customParseFormat.js"></script>
  <script>dayjs.extend(window.dayjs_plugin_customParseFormat);</script>
  <script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="assets/js/kho.js"></script>
  <script src="assets/js/transvi.js"></script>
  <script src="assets/js/thuoc.js"></script>

  <!-- Switch 2 chế độ -->
  <script>
    (function () {
      const tabKho   = document.getElementById('tabKho');
      const tabThuoc = document.getElementById('tabThuoc');
      const chatKho  = document.getElementById('chatKho');
      const chatThuoc= document.getElementById('chatThuoc');

      function ensureDrugUI(){ if (window.buildDrugUI) window.buildDrugUI(); }
      function activate(which){
        const isKho = which === 'kho';
        tabKho.setAttribute('aria-pressed', String(isKho));
        tabThuoc.setAttribute('aria-pressed', String(!isKho));
        chatKho.classList.toggle('hidden', !isKho);
        chatThuoc.classList.toggle('hidden', isKho);
        if (!isKho) ensureDrugUI();
      }
      tabKho?.addEventListener('click',   () => activate('kho'));
      tabThuoc?.addEventListener('click', () => activate('thuoc'));
      activate('kho');
    })();
  </script>
</body>
</html>
